#include "../libk.h"

// build arg2.HLindex and arg2.HLchange
// int look is the offset: where to start looking for the next occurence of query
// of an opening brace

void bildHL(int option, int look, char* abuff)
{

// highlight segment with  the <esc>[31m escape sequence and <esc>[39m sequence.

   char* red     = "\x1b[31m"; //precede HL sequence 
   char* revert  = "\x1b[39m"; //follow  HL sequence
 
//   typedef struct {int HLindex; char* HLchange;} high;
//   high arg2[50];

   if (option == 1)   // highlight query (FIND)
   {
      char* query = "find";
      // int look  **      the offset to start looking for the next occurence of query
      int ndex;          //the index of the current found query
      int counter = 0;   //the number of occurrences, before the current 
  
      while(strstr(abuff + look,query) != NULL) 
        {
         ndex = (int) (strstr(abuff + look,query) - abuff);

         arg2.HLindex[counter] = ndex;     arg2.HLchange[counter] = red;    
         counter++;
         look = ndex + strlen(query);
         arg2.HLindex[counter] = look;     arg2.HLchange[counter] = revert; 
         counter++;
        }   
      return; 
   }

   if (option == 2)   // highlight completed braces sequence (BRAS)
   {
        s = abuf;
        i=0;       /* i indicates the depth of bracketing */ 
        int k = 0; /* k indicates the number of bracket initiated */  
        int ndex;  /* ndex is the index into abuf (and s) */
        for (ndex=0; s[ndex]; ndex++) 
          {
           if ( (s[ndex]== '{') && (k != 0)) 
             {arg2.HLindex[0] = ndex;    arg2.HLchange[0] = red; }
           if (s[ndex]=='{')  {i++; k++;}
           if (s[ndex]=='}')  i--;
           if ((i == 0) && (k > 0)) break;
          };    
        arg2.HLindex[1] = ndex;    arg2.HLchange[1] = revert; 
//      if (i == 0) printf("the bracket was closed with k = %d \n",k);
        return;
   }
   return; // the default (noaction)
}
